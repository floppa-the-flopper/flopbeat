createFilters=(...names)=>{for(i of names){this[i]??={a:0,b:0,c:0,d:0,e:0,f:0,g:0,h:0}}},
useFilter=(value,name,amount=0.5,stage='h',acidity=0.9)=>(
z=acidity+acidity/(1-amount),
this[name].a+=amount*(value-this[name].a+z*(this[name].a-this[name].b)),
this[name].b+=amount*(this[name].a-this[name].b),
this[name].c+=amount*(this[name].b-this[name].c),
this[name].d+=amount*(this[name].c-this[name].d),
this[name].e+=amount*(this[name].d-this[name].e),
this[name].f+=amount*(this[name].e-this[name].f),
this[name].g+=amount*(this[name].f-this[name].g),
this[name].h+=amount*(this[name].g-this[name].h),
this[name][stage]
),useFilterHi=(value,name,amount=0.5,stage='h',acidity=0.9)=>(
value-useFilter(value,name,amount,stage,acidity)
),createFilters('filter'),
t/=4,

this.LFSR??=65535,

this.noise??= function(t,o=2,w=0) {


	//if (t<2) {console.error("start")}

	processLFSR = function(width=0) {
		S=width?100000100000000:100000000000000
		trade =(a,b)=>(LFSR[a] = LFSR[b])
		temp= LFSR&1^((LFSR&2)>>1)
		LFSR>>=1,
		LFSR = (temp ? (LFSR|S) : (LFSR&~S))
	}

	if ((t%(1<<(o)))==0) {
	processLFSR(w)
	//console.log(LFSR)
	v=LFSR&1
	}
	return v*128

},

this.track??=
[/*
         N SS SS TT s A V*/
/*   0*/'           0 0 0 ',
/*   1*/'  C4       0 0 3 ',
/*   2*/'     C3    2 1 4 ',
/*   3*/'  C4    C3 2 3 5 ',
/*   4*/'  C4    C3 3 4 5 ',
/*   5*/'  C4    C3 3 5 6 ',
/*   6*/'  C4    C3 3 5 7 ',
/*   7*/'  C4    C3 3 5 7 ',
/*   8*/'  C4    C3 3 5 7 ',
/*   9*/'  C4    C3 3 5 6 ',
/*   A*/'  C4    C3 3 5 5 ',
/*   B*/'  C4    C3 3 5 5 ',
/*   C*/'  C4    C3 2 5 4 ',
/*   D*/'  C4    C3 2 1 3 ',
/*   E*/'  C4    C3 0 0 2 ',
/*   F*/'           0 0 0 ',

/*  10*/'           0 0 0 ',
/*  11*/'  C4       0 0 3 ',
/*  12*/'     A3    2 1 4 ',
/*  13*/'  C4    A3 2 3 5 ',
/*  14*/'  C4    A3 3 4 5 ',
/*  15*/'  C4    A3 3 5 6 ',
/*  16*/'  C4    A3 3 5 7 ',
/*  17*/'  C4    A3 3 5 7 ',
/*  18*/'  C4    A3 3 5 7 ',
/*  19*/'  C4    J3 3 5 6 ',
/*  1A*/'  C4    J3 3 5 5 ',
/*  1B*/'  C4    J3 3 5 5 ',
/*  1C*/'  C4    J3 2 5 4 ',
/*  1D*/'  C4    J3 2 1 3 ',
/*  1E*/'  C4    J3 0 0 2 ',
/*  1F*/'           0 0 0 ',

/*  20*/'           0 0 0 ',
/*  21*/'  H4       0 0 3 ',
/*  22*/'     C3    2 1 4 ',
/*  23*/'  H4    C3 2 3 5 ',
/*  24*/'  H4    C3 3 4 5 ',
/*  25*/'  H4    C3 3 5 6 ',
/*  26*/'  H4    C3 3 5 7 ',
/*  27*/'  H4    C3 3 5 7 ',
/*  28*/'  H4    C3 3 5 7 ',
/*  29*/'  H4    C3 3 5 6 ',
/*  2A*/'  G4    G2 3 5 5 ',
/*  2B*/'  F4       3 5 5 ',
/*  2C*/'  F4       2 5 4 ',
/*  2D*/'  F4       2 1 3 ',
/*  2E*/'  F4       0 0 2 ',
/*  2F*/'           0 0 0 ',

/*  30*/'           0 0 0 ',
/*  31*/'  J4       0 0 3 ',
/*  32*/'     E3    2 1 4 ',
/*  33*/'  J4    E3 2 3 5 ',
/*  34*/'  J4    E3 3 4 5 ',
/*  35*/'  J4    E3 3 5 6 ',
/*  36*/'  J4    E3 3 5 7 ',
/*  37*/'  J4    E3 3 5 7 ',
/*  38*/'  J4    E3 3 5 7 ',
/*  39*/'  J4    E3 3 5 6 ',
/*  3A*/'  J4    E2 3 5 5 ',
/*  3B*/'  E4       3 5 5 ',
/*  3C*/'  E4       2 5 4 ',
/*  3D*/'  E4       2 1 3 ',
/*  3E*/'  E4       0 0 2 ',
/*  3F*/'           0 0 0 ',





/*  40*/'4          0 0 0 ',
/*  41*/'  C4       0 0 3 ',
/*  42*/'     C3    2 1 4 ',
/*  43*/'  C4    C3 2 3 5 ',
/*  44*/'7 C4    C3 3 4 5 ',
/*  45*/'  C4    C3 3 5 6 ',
/*  46*/'  C4    C3 3 5 7 ',
/*  47*/'4 C4    C3 3 5 7 ',
/*  48*/'  C4    C3 3 5 7 ',
/*  49*/'  C4    C3 3 5 6 ',
/*  4A*/'  C4    C3 3 5 5 ',
/*  4B*/'  C4    C3 3 5 5 ',
/*  4C*/'8 C4    C3 2 5 4 ',
/*  4D*/'  C4    C3 2 1 3 ',
/*  4E*/'  C4    C3 0 0 2 ',
/*  4F*/'           0 0 0 ',

/*  50*/'           0 0 0 ',
/*  51*/'6 C4       0 0 3 ',
/*  52*/'     A3    2 1 4 ',
/*  53*/'  C4    A3 2 3 5 ',
/*  54*/'  C4    A3 3 4 5 ',
/*  55*/'  C4    A3 3 5 6 ',
/*  56*/'  C4    A3 3 5 7 ',
/*  57*/'  C4    A3 3 5 7 ',
/*  58*/'  C4    A3 3 5 7 ',
/*  59*/'  C4    J3 3 5 6 ',
/*  5A*/'3 C4    J3 3 5 5 ',
/*  5B*/'3 C4    J3 3 5 5 ',
/*  5C*/'  C4    J3 2 5 4 ',
/*  5D*/'  C4    J3 2 1 3 ',
/*  5E*/'6 C4    J3 0 0 2 ',
/*  5F*/'           0 0 0 ',

/*  60*/'           0 0 0 ',
/*  61*/'  H4       0 0 3 ',
/*  62*/'7    C3    2 1 4 ',
/*  63*/'  H4    C3 2 3 5 ',
/*  64*/'  H4    C3 3 4 5 ',
/*  65*/'9 H4    C3 3 5 6 ',
/*  66*/'  H4    C3 3 5 7 ',
/*  67*/'  H4    C3 3 5 7 ',
/*  68*/'4 H4    C3 3 5 7 ',
/*  69*/'5 H4    C3 3 5 6 ',
/*  6A*/'5 G4    G2 3 5 5 ',
/*  6B*/'  F4       3 5 5 ',
/*  6C*/'  F4       2 5 4 ',
/*  6D*/'  F4       2 1 3 ',
/*  6E*/'2 F4       0 0 2 ',
/*  6F*/'           0 0 0 ',

/*  70*/'           0 0 0 ',
/*  71*/'4 J4       0 0 3 ',
/*  72*/'     E3    2 1 4 ',
/*  73*/'  J4    E3 2 3 5 ',
/*  74*/'  J4    E3 3 4 5 ',
/*  75*/'  J4    E3 3 5 6 ',
/*  76*/'5 J4    E3 3 5 7 ',
/*  77*/'  J4    E3 3 5 7 ',
/*  78*/'  J4    E3 3 5 7 ',
/*  79*/'3 J4    E3 3 5 6 ',
/*  7A*/'  J4    E2 3 5 5 ',
/*  7B*/'  E4       3 5 5 ',
/*  7C*/'7 E4       2 5 4 ',
/*  7D*/'8 E4       2 1 3 ',
/*  7E*/'  E4       0 0 2 ',
/*  7F*/'           0 0 0 ',



/*  80*/'3          0 0 0 ',
/*  81*/'3 C4       0 0 3 ',
/*  82*/'3    C3    2 1 4 ',
/*  83*/'3 C4    C3 2 3 5 ',
/*  84*/'0 C4    C3 3 4 5!',
/*  85*/'  C4    C3 3 5 6 ',
/*  86*/'  C4    C3 3 5 7 ',
/*  87*/'  C4    C3 3 5 7 ',
/*  88*/'  C4    C3 3 5 7 ',
/*  89*/'6 C4    C3 3 5 6 ',
/*  8A*/'  C4    C3 3 5 5 ',
/*  8B*/'  C4    C3 3 5 5 ',
/*  8C*/'3 C4    C3 2 5 4 ',
/*  8D*/'  C4    C3 2 1 3 ',
/*  8E*/'  C4    C3 0 0 2 ',
/*  8F*/'           0 0 0 ',

/*  90*/'           0 0 0 ',
/*  91*/'7 C4       0 0 3 ',
/*  92*/'     A3    2 1 4 ',
/*  93*/'  C4    A3 2 3 5 ',
/*  94*/'2 C4    A3 3 4 5 ',
/*  95*/'2 C4    A3 3 5 6!',
/*  96*/'2 C4    A3 3 5 7 ',
/*  97*/'  C4    A3 3 5 7 ',
/*  98*/'  C4    A3 3 5 7 ',
/*  99*/'  C4    J3 3 5 6 ',
/*  9A*/'1 C4    J3 3 5 5 ',
/*  9B*/'  C4    J3 3 5 5 ',
/*  9C*/'  C4    J3 2 5 4 ',
/*  9D*/'0 C4    J3 2 1 3 ',
/*  9E*/'  C4    J3 0 0 2 ',
/*  9F*/'           0 0 0 ',

/*  A0*/'           0 0 0 ',
/*  A1*/'  H4       0 0 3 ',
/*  A2*/'4    C3    2 1 4 ',
/*  A3*/'  H4    C3 2 3 5 ',
/*  A4*/'  H4    C3 3 4 5 ',
/*  A5*/'6 H4    C3 3 5 6 ',
/*  A6*/'  H4    C3 3 5 7 ',
/*  A7*/'  H4    C3 3 5 7 ',
/*  A8*/'  H4    C3 3 5 7 ',
/*  A9*/'0 H4    C3 3 5 6 ',
/*  AA*/'0 G4    G2 3 5 5!',
/*  AB*/'0 F4       3 5 5 ',
/*  AC*/'0 F4       2 5 4 ',
/*  AD*/'  F4       2 1 3 ',
/*  AE*/'  F4       0 0 2 ',
/*  AF*/'           0 0 0 ',

/*  B0*/'           0 0 0 ',
/*  B1*/'3 J4       0 0 3 ',
/*  B2*/'     E3    2 1 4 ',
/*  B3*/'  J4    E3 2 3 5 ',
/*  B4*/'  J4    E3 3 4 5 ',
/*  B5*/'0 J4    E3 3 5 6 ',
/*  B6*/'0 J4    E3 3 5 7 ',
/*  B7*/'  J4    E3 3 5 7 ',
/*  B8*/'  J4    E3 3 5 7 ',
/*  B9*/'  J4    E3 3 5 6 ',
/*  BA*/'  J4    E2 3 5 5 ',
/*  BB*/'  E4       3 5 5 ',
/*  BC*/'  E4       2 5 4 ',
/*  BD*/'5 E4       2 1 3 ',
/*  BE*/'  E4       0 0 2 ',
/*  BF*/'           0 0 0 ',



/*  C0*/'3          0 0 0 ',
/*  C1*/'3 C4       0 0 3!',
/*  C2*/'3    C3    2 1 4 ',
/*  C3*/'3 C4    C3 2 3 5!',
/*  C4*/'0 C4    C3 3 4 5 ',
/*  C5*/'  C4    C3 3 5 6 ',
/*  C6*/'  C4    C3 3 5 7 ',
/*  C7*/'  C4    C3 3 5 7 ',
/*  C8*/'  C4    C3 3 5 7 ',
/*  C9*/'6 C4    C3 3 5 6 ',
/*  CA*/'  C4    C3 3 5 5 ',
/*  CB*/'  C4    C3 3 5 5 ',
/*  CC*/'3 C4    C3 2 5 4!',
/*  CD*/'  C4    C3 2 1 3 ',
/*  CE*/'  C4    C3 0 0 2 ',
/*  CF*/'           0 0 0 ',

/*  D0*/'           0 0 0 ',
/*  D1*/'7 C4       0 0 3 ',
/*  D2*/'     A3    2 1 4 ',
/*  D3*/'  C4    A3 2 3 5 ',
/*  D4*/'2 C4    A3 3 4 5 ',
/*  D5*/'2 C4    A3 3 5 6 ',
/*  D6*/'2 C4    A3 3 5 7 ',
/*  D7*/'  C4    A3 3 5 7 ',
/*  D8*/'  C4    A3 3 5 7 ',
/*  D9*/'  C4    J3 3 5 6 ',
/*  DA*/'1 C4    J3 3 5 5 ',
/*  DB*/'  C4    J3 3 5 5 ',
/*  DC*/'  C4    J3 2 5 4 ',
/*  DD*/'0 C4    J3 2 1 3!',
/*  DE*/'  C4    J3 0 0 2 ',
/*  DF*/'           0 0 0 ',

/*  E0*/'           0 0 0 ',
/*  E1*/'  H4       0 0 3 ',
/*  E2*/'4    C3    2 1 4!',
/*  E3*/'  H4    C3 2 3 5 ',
/*  E4*/'  H4    C3 3 4 5 ',
/*  E5*/'6 H4    C3 3 5 6 ',
/*  E6*/'  H4    C3 3 5 7 ',
/*  E7*/'  H4    C3 3 5 7 ',
/*  E8*/'  H4    C3 3 5 7 ',
/*  E9*/'0 H4    C3 3 5 6 ',
/*  EA*/'0 G4    G2 3 5 5 ',
/*  EB*/'0 F4       3 5 5!',
/*  EC*/'0 F4       2 5 4!',
/*  ED*/'  F4       2 1 3 ',
/*  EE*/'  F4       0 0 2 ',
/*  EF*/'           0 0 0 ',

/*  F0*/'           0 0 0 ',
/*  F1*/'3 J4       0 0 3 ',
/*  F2*/'     E3    2 1 4 ',
/*  F3*/'  J4    E3 2 3 5 ',
/*  F4*/'  J4    E3 3 4 5 ',
/*  F5*/'0 J4    E3 3 5 6 ',
/*  F6*/'0 J4    E3 3 5 7 ',
/*  F7*/'  J4    E3 3 5 7 ',
/*  F8*/'  J4    E3 3 5 7 ',
/*  F9*/'  J4    E3 3 5 6 ',
/*  FA*/'0 J4    E2 3 5 5!',
/*  FB*/'0 E4       3 5 5!',
/*  FC*/'0 E4       2 5 4!',
/*  FD*/'0 E4       2 1 3!',
/*  FE*/'0 E4       0 0 2!',
/*  FF*/'0          0 0 0!',

/* NaN*/'           0 0 0 ',
],
o0= (note,oct,amp) => (((t*4)*2**((note/12)+oct))&128)/(128/amp), // Square wave synth
o1= (note,oct,amp) => (temp=(((t*4)*2**((note/12)+oct))&255),temp>128?255-temp:temp)/(128/amp), // Triangle wave synth
i=t>>3,	// Noise fade
r=int(i>>8)%(track.length-1),
STR=track[r]??'                 ', // Tracker
i&=255, // Noise fade pt 2


dis=sin((t/512)*STR[11])/t*STR[13]*8,

N=STR[0]==' '?0:noise(t,STR[0],STR[16]=='!')/max(1,i/64),  // Noise channel
S1=STR[2]==' '?0:o0(STR.charCodeAt(2)-67+dis,STR[3]-2,128),	     // Square channel 1
S2=STR[5]==' '?0:o0(STR.charCodeAt(5)-67+dis,STR[6]-2,128),     //  Square channel 2
T=STR[8]==' '?0:o1(STR.charCodeAt(8)-67+dis,STR[9]-2,128),     // Triangle channel
this.H ??= 0, H++,
((A)=>{
	if(H>260 && A) {
	H=0;
	throw `\nTick.......: ${r.toString(16)}/${(track.length-1).toString(16)} ${r>=track.length-1?' (Track finished) ':''}${''.padEnd((i>>4)&15,';')}`
	+ STR
	.replace(/([\d\s])\s([\w\s][\d\s])\s([\w\s][\d\s])\s([\w\s][\d\s]) (\d) (\d) (\d)([! ])/g,'\n\nNoise....: $1$8\nSquare1: $2\nSquare2: $3\nTriangle.: $4\n Vibrato: Freqency $5 Amplitude $6. Volume $7.')
	}
})(1), // Change 1 to 0 to disable info
O=(N+S1+S2+T)*(4/9)/49*(STR[15]**2)//,useFilterHi(O,'filter',0.2,'a',0.6)/1.2+128